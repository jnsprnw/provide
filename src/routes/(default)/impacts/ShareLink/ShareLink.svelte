<script>
  import { IS_COMBINATION_AVAILABLE, IS_EMPTY_SELECTION, CURRENT_GEOGRAPHY_UID, CURRENT_INDICATOR_UID, CURRENT_INDICATOR_OPTION_VALUES, CURRENT_SCENARIOS_UID, CURRENT_INDICATOR_OPTIONS } from '$stores/state.js';
  import { PATH_IMPACT } from '$config';
  import { buildURL } from '$utils/url.js';
  import tooltip from '$lib/utils/tooltip';
  import copy from 'copy-to-clipboard';
  import { page } from '$app/stores';

  $: isDisabled = $IS_EMPTY_SELECTION || !$IS_COMBINATION_AVAILABLE;

  $: query = !isDisabled && buildURL(PATH_IMPACT, { indicator: $CURRENT_INDICATOR_UID, geography: $CURRENT_GEOGRAPHY_UID, scenarios: $CURRENT_SCENARIOS_UID, ...$CURRENT_INDICATOR_OPTION_VALUES });

  function handleClick() {
    if (query) {
      const { origin, pathname } = $page.url;
      if (origin && pathname) {
        copy(`${origin}${pathname}${query}`);
      } else {
        console.warn(`Could not determine origin or pathname.`);
      }
    } else {
      console.warn(`Could not determine query.`);
    }

  }
</script>

<button
  aria-disabled={isDisabled}
  class="flex items-center gap-x-2 text-sm font-bold px-3 py-2 hover:bg-white rounded-xl transition-colors text-theme-base aria-disabled:hover:bg-transparent aria-disabled:cursor-not-allowed aria-disabled:text-theme-weaker"
  on:click={!isDisabled && handleClick}
  use:tooltip={{ content: isDisabled ? 'Select a geography and indicator first' : 'Click to copy the link to the clipboard' }}
>
  <svg class="h-3" viewBox="0 0 16 17" fill="currentColor" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.42034 16.3918C3.67811 16.3931 2.95225 16.1538 2.33477 15.7043C1.7173 15.2548 1.23601 14.6153 0.951917 13.867C0.667826 13.1186 0.593724 12.295 0.739005 11.5006C0.884285 10.7063 1.24241 9.97685 1.76797 9.40486L4.75208 6.14897C5.45609 5.38238 6.40997 4.95186 7.40445 4.95186C8.39894 4.95186 9.35282 5.38238 10.0568 6.14897C10.1985 6.31385 10.2758 6.53242 10.2725 6.75843C10.2691 6.98444 10.1853 7.20015 10.0388 7.35993C9.8923 7.51971 9.69458 7.61101 9.48749 7.61452C9.2804 7.61803 9.08018 7.53347 8.9292 7.37874C8.5244 6.93826 7.97608 6.69091 7.40445 6.69091C6.83282 6.69091 6.2845 6.93826 5.8797 7.37874L2.89559 10.6355C2.4912 11.0768 2.26401 11.6754 2.26401 12.2996C2.26401 12.6086 2.31979 12.9146 2.42815 13.2001C2.53652 13.4857 2.69535 13.7451 2.89559 13.9636C3.09582 14.1821 3.33353 14.3555 3.59515 14.4738C3.85677 14.592 4.13717 14.6529 4.42034 14.6529C4.99223 14.6529 5.5407 14.405 5.94509 13.9636L6.33186 13.5415C6.40616 13.4607 6.49432 13.3967 6.5913 13.353C6.68828 13.3094 6.79219 13.2871 6.89708 13.2873C7.00197 13.2875 7.1058 13.3102 7.20264 13.3542C7.29948 13.3982 7.38743 13.4626 7.46147 13.5437C7.53551 13.6248 7.59419 13.721 7.63416 13.8268C7.67413 13.9327 7.69461 14.0461 7.69442 14.1605C7.69424 14.275 7.67339 14.3883 7.63308 14.494C7.59277 14.5997 7.53378 14.6957 7.45948 14.7765L7.07271 15.1986C6.72439 15.5783 6.31077 15.8792 5.8556 16.084C5.40042 16.2888 4.91266 16.3934 4.42034 16.3918Z" fill="currentColor"/>
    <path d="M8.60145 11.8331C8.10886 11.8339 7.62097 11.7285 7.1658 11.523C6.71063 11.3175 6.29714 11.0159 5.94908 10.6355C5.80381 10.4714 5.72343 10.2515 5.72525 10.0233C5.72707 9.79511 5.81094 9.57682 5.95879 9.41546C6.10665 9.25409 6.30666 9.16256 6.51576 9.16058C6.72485 9.1586 6.92629 9.24632 7.07669 9.40486C7.48747 9.83282 8.03354 10.0716 8.60145 10.0716C9.16935 10.0716 9.71542 9.83282 10.1262 9.40486L13.1095 6.14897C13.3101 5.93067 13.4693 5.67132 13.5779 5.38576C13.6865 5.10021 13.7424 4.79408 13.7424 4.48491C13.7424 4.17573 13.6865 3.8696 13.5779 3.58405C13.4693 3.29849 13.3101 3.03914 13.1095 2.82084C12.699 2.39274 12.153 2.15384 11.5852 2.15384C11.0173 2.15384 10.4714 2.39274 10.0608 2.82084L9.4659 3.47011C9.31626 3.6333 9.11335 3.72493 8.90181 3.72485C8.69026 3.72477 8.48742 3.63298 8.33788 3.46967C8.18835 3.30636 8.10439 3.08491 8.10446 2.85404C8.10454 2.62317 8.18865 2.40179 8.33828 2.2386L8.93319 1.58933C9.63664 0.822187 10.5905 0.391438 11.585 0.391846C12.5794 0.392254 13.533 0.823785 14.2359 1.59151C14.9389 2.35923 15.3335 3.40026 15.3332 4.48557C15.3328 5.57089 14.9374 6.61159 14.2339 7.37874L11.2498 10.6346C10.9023 11.0147 10.4895 11.3162 10.0351 11.5219C9.5806 11.7275 9.09342 11.8333 8.60145 11.8331Z" fill="currentColor"/>
  </svg>
  Share these results<br />
</button>
